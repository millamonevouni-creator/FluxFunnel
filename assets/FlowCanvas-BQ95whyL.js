import{N as a,j as e,a as O,U as Te}from"./index-eBZt-p7n.js";import{R as we,r as l}from"./vendor-KfUPlHYY.js";import{C as ve,a as Re}from"./CustomEdge-C1C3FYoo.js";import{ar as Oe,as as ke,at as De,au as Le,k as Ie,av as _e,aw as $e,ax as Me,ay as Ge,az as Fe,aA as ze,aB as Ke,aC as Y,X as oe,T as Be,o as He,m as Pe,aD as We,aE as Ve,aF as Ye,aG as Xe,aH as Ze,aI as Je,aJ as Qe,aK as qe,aL as Ue}from"./ui-DazhNhsc.js";import"./utils-ig63ahen.js";const et=({isDark:i,t:x,userPlan:N})=>{const o=(m,A)=>{if(N==="FREE"&&O[A].isPro){m.preventDefault();return}m.dataTransfer.setData("application/reactflow",A),m.dataTransfer.effectAllowed="move"},y=[{id:"TRAFFIC",label:x("trafficSources"),icon:e.jsx(Oe,{size:14}),types:[a.META_ADS,a.FACEBOOK_ADS,a.INSTAGRAM,a.GOOGLE_ADS,a.GOOGLE_SEARCH,a.YOUTUBE,a.BING_ADS,a.TIKTOK_ADS,a.KWAI,a.TWITCH,a.PINTEREST,a.ORGANIC_SOCIAL]},{id:"CHANNELS",label:x("communication"),icon:e.jsx(ke,{size:14}),types:[a.WHATSAPP,a.TELEGRAM,a.DISCORD,a.ZOOM,a.GOOGLE_MEET,a.EMAIL,a.SMS,a.CALL]},{id:"PAGES",label:x("funnelPages"),icon:e.jsx(De,{size:14}),types:[a.LANDING_PAGE,a.OPTIN_PAGE,a.VSL,a.CHECKOUT,a.ORDER_PAGE,a.UPSELL,a.DOWNSELL,a.THANK_YOU,a.WEBINAR,a.LIVE_WEBINAR,a.POPUP,a.DOWNLOAD_PAGE,a.CALENDAR_PAGE,a.GENERIC_PAGE,a.BLOG,a.QUIZ,a.MEMBERSHIP_AREA,a.SYSTEM_PAGE,a.ECOMMERCE_PAGE]},{id:"OPS",label:x("opsLogic"),icon:e.jsx(Le,{size:14}),types:[a.NOTE,a.ADD_TO_CART,a.ADD_TO_LIST,a.AB_TEST,a.LEAD,a.SUBSCRIBER,a.REVENUE,a.CRM_PIPELINE,a.MEETING]}],j=i?"bg-slate-900 border-slate-800":"bg-white border-slate-200",L=i?"text-white":"text-slate-800",c=i?"text-slate-400":"text-slate-500";return e.jsxs("aside",{className:`w-80 border-r flex flex-col h-full z-10 shadow-xl transition-colors duration-300 ${j}`,children:[e.jsxs("div",{className:`p-5 border-b ${i?"border-slate-800":"border-slate-200"}`,children:[e.jsx("h2",{className:`font-bold text-lg tracking-tight ${L}`,children:x("componentLib")}),e.jsx("p",{className:`text-xs mt-1 ${c}`,children:x("dragElements")})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 p-5 space-y-8 scrollbar-thin scrollbar-thumb-slate-400",children:[y.map(m=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-indigo-600",children:m.icon}),e.jsx("h3",{className:`text-xs font-bold uppercase tracking-widest ${c}`,children:m.label})]}),e.jsx("div",{className:"grid gap-3 grid-cols-3",children:m.types.map(A=>{const u=O[A],w=N==="FREE"&&u.isPro;return e.jsxs("div",{onDragStart:X=>o(X,A),draggable:!w,className:`group flex flex-col items-center ${w?"cursor-not-allowed opacity-50":"cursor-grab active:cursor-grabbing"}`,title:w?"Upgrade to Pro to use":u.label,children:[e.jsxs("div",{className:`
                            w-14 h-14 rounded-2xl flex items-center justify-center shadow-sm border-b-2 transition-all duration-200 
                            ${w?"":"hover:scale-110 hover:-translate-y-1 hover:shadow-lg"}
                            ${u.bg} ${i?"border-black/20":"border-slate-300"}
                            relative
                        `,children:[we.cloneElement(u.icon,{size:28,color:"white"}),w&&e.jsx("div",{className:"absolute inset-0 bg-black/40 rounded-2xl flex items-center justify-center",children:e.jsx(Ie,{size:16,className:"text-white"})})]}),e.jsx("span",{className:`mt-2 text-[10px] font-medium text-center leading-tight max-w-[70px] ${c} ${!w&&`group-hover:${L}`}`,children:u.label})]},A)})})]},m.id)),e.jsx("div",{className:"h-10"})]})]})};let tt=1e3;const st=()=>`${tt++} `,at=({snapLines:i,reactFlowInstance:x})=>{const N=l.useRef(null),o=l.useRef(null);return l.useLayoutEffect(()=>{if(N.current&&i.x!==void 0&&x){const y=x.project({x:i.x,y:0}).x;N.current.style.transform=`translateX(${y}px)`}if(o.current&&i.y!==void 0&&x){const y=x.project({x:0,y:i.y}).y;o.current.style.transform=`translateY(${y}px)`}},[i,x]),e.jsxs("div",{className:"absolute inset-0 pointer-events-none z-[10]",children:[i.x!==void 0&&e.jsx("div",{ref:N,className:"absolute top-0 bottom-0 border-l border-cyan-400/50"}),i.y!==void 0&&e.jsx("div",{ref:o,className:"absolute left-0 right-0 border-t border-cyan-400/50"})]})},lt=({project:i,onSaveProject:x,onSaveTemplate:N,onUnsavedChanges:o,triggerSaveSignal:y,isDark:j,toggleTheme:L,isPresentationMode:c,showNotesInPresentation:m,t:A,userPlan:u,showAIAssistant:w,onToggleAIAssistant:X,isSharedView:ot,onShareToMarketplace:rt,openSaveModalSignal:z,maxNodes:re=20,plans:ce,showNotification:S})=>{const ne=l.useRef(null),{screenToFlowPosition:Z,getNodes:b,getEdges:v}=$e(),[E,p]=Me(i.nodes),[k,g]=Ge(i.edges),[K,ie]=l.useState(null),[J,I]=l.useState(!1),[B,Q]=l.useState({reason:"LIMIT_REACHED",limitType:"NODES"}),[de,_]=l.useState(!1),[ue,xe]=l.useState(!1),[me,q]=l.useState("OPTIONS"),[U,ee]=l.useState(""),[ct,nt]=l.useState(""),[pe,te]=l.useState(!1),[se,H]=l.useState(null),R=re,[$,M]=l.useState([]),[P,G]=l.useState([]),f=l.useCallback(()=>{M(s=>{const t=[...s,{nodes:b(),edges:v()}];return t.length>50&&t.shift(),t}),G([])},[b,v]),ae=l.useCallback(()=>{if($.length===0)return;const s={nodes:b(),edges:v()},t=$[$.length-1];M(r=>r.slice(0,r.length-1)),G(r=>[s,...r]),p(t.nodes),g(t.edges),o()},[$,b,v,p,g,o]),W=l.useCallback(()=>{if(P.length===0)return;const s={nodes:b(),edges:v()},t=P[0];G(r=>r.slice(1)),M(r=>[...r,s]),p(t.nodes),g(t.edges),o()},[P,b,v,p,g,o]);l.useEffect(()=>{const s=t=>{c||((t.ctrlKey||t.metaKey)&&t.key==="z"&&(t.preventDefault(),t.shiftKey?W():ae()),(t.ctrlKey||t.metaKey)&&t.key==="y"&&(t.preventDefault(),W()))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ae,W,c]),l.useEffect(()=>{y&&y>0&&x(E,k)},[y]),l.useEffect(()=>{z&&z>0&&_(!0)},[z]);const fe=l.useCallback(s=>{const t=s.every(n=>n.type==="select");s.some(n=>n.type==="remove")&&f(),p(n=>Fe(s,n)),t||o()},[p,o,f]),be=l.useCallback(s=>{s.some(r=>r.type==="remove")&&f(),g(r=>ze(s,r)),s.some(r=>r.type!=="select")&&o()},[g,o,f]),ge=l.useMemo(()=>{const s=new Set;return E.forEach(t=>{t.data.type===a.NOTE&&c&&(!m||t.data.isTransparent)&&s.add(t.id)}),k.map(t=>({...t,hidden:s.has(t.source)||s.has(t.target)}))},[k,E,c,m]),[d,D]=l.useState(null),[it,le]=l.useState({x:0,y:0});l.useEffect(()=>{p(i.nodes),g(i.edges),M([]),G([])},[i.id]);const F=l.useCallback((s,t)=>{if(!c){if(u==="FREE"&&O[t].isPro){S==null||S("Disponível nos planos Pro e Premium.","error");return}f(),p(r=>r.map(n=>n.id===s?{...n,data:{...n.data,type:t,label:O[t].label}}:n)),o()}},[p,c,u,o,f]);l.useEffect(()=>{p(s=>s.map(t=>({...t,data:{...t.data,isPresentationMode:c,showNotes:m,isConnectionActive:!!d,onConnectAction:V,onSwapType:F,userPlan:u},draggable:!c,selectable:!0})))},[c,m,d,p,F,u]);const Ee=l.useMemo(()=>({custom:ve}),[]),he=l.useMemo(()=>({custom:Re}),[]),Ne=l.useMemo(()=>({type:"custom",markerEnd:{type:Ke.ArrowClosed,width:20,height:20},style:{strokeWidth:2,stroke:"#64748b"},animated:!0}),[]),V=l.useCallback((s,t,r)=>{if(!c){if(t==="start-auto"){D({nodeId:s,handleId:"auto"});const n=b().find(h=>h.id===s);n&&le({x:n.position.x+50,y:n.position.y+50});return}if(t==="end-auto"&&d){if(d.nodeId===s)return;const n=b().find(C=>C.id===d.nodeId),h=b().find(C=>C.id===s);if(n&&h){f();const C={id:`e${d.nodeId} -${s} -${Date.now()} `,source:d.nodeId,target:s,type:"custom",animated:!0};g(T=>Y(C,T)),o()}D(null);return}if(t==="source"&&r)if(d){if(d.nodeId===s)return;f();const n={id:`e${d.nodeId} -${s} -${Date.now()} `,source:d.nodeId,sourceHandle:d.handleId==="auto"?"right":d.handleId,target:s,targetHandle:r,type:"custom",animated:!0};g(h=>Y(n,h)),o(),D(null)}else D({nodeId:s,handleId:r})}},[d,g,b,c,o,f]),ye=l.useCallback(s=>{if(d){const t=Z({x:s.clientX,y:s.clientY});le(t)}},[d,Z]);l.useCallback(()=>{d&&D(null)},[d]);const Se=l.useCallback(s=>{c||(f(),g(t=>Y({...s,type:"custom",animated:!0},t)),o())},[g,c,o,f]),je=l.useCallback(s=>{if(s.preventDefault(),c)return;if(E.length>=R){Q({reason:"LIMIT_REACHED",limitType:"NODES"}),I(!0);return}const t=s.dataTransfer.getData("application/reactflow");if(!t||u==="FREE"&&O[t].isPro)return;f();const r=K.screenToFlowPosition({x:s.clientX,y:s.clientY}),n={id:st(),type:"custom",position:r,data:{label:O[t].label,type:t,isPresentationMode:c,showNotes:m,userPlan:u,onConnectAction:V,onSwapType:F}};p(h=>h.concat(n)),o()},[K,p,c,m,o,E.length,R,u,V,F,f]),Ae=l.useCallback((s,t)=>{if(c)return;const r=b().filter(T=>T.id!==t.id);let n,h;const C=5;for(const T of r)Math.abs(T.position.x-t.position.x)<C&&(n=T.position.x),Math.abs(T.position.y-t.position.y)<C&&(h=T.position.y);H(n||h?{x:n,y:h}:null)},[b,c]),Ce=l.useCallback(()=>{H(null),o()},[o]);return e.jsxs("div",{className:"flex h-full w-full relative",children:[!c&&e.jsx(et,{isDark:j,t:A,userPlan:u}),J&&e.jsx(Te,{onClose:()=>I(!1),onUpgrade:()=>{S==null||S("Redirecionando...","success"),I(!1)},isDark:j,plans:ce,limitType:B.limitType,reason:B.reason,featureName:B.featureName,userPlan:u}),ue&&e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in-up",children:e.jsxs("div",{className:`relative w - full max - w - md rounded - 2xl shadow - 2xl p - 6 border ${j?"bg-slate-900 border-slate-700":"bg-white border-slate-200"} `,children:[e.jsx("button",{onClick:()=>xe(!1),className:"absolute top-4 right-4 p-2 text-slate-400",title:"Fechar",children:e.jsx(oe,{size:20})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(Be,{size:28,className:"mx-auto text-indigo-600 mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-1",children:"Compartilhar"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg border bg-slate-50 dark:bg-slate-800",children:[e.jsxs("div",{className:"flex-1 truncate text-xs px-2 font-mono",children:[window.location.origin,"/?share=",i.id]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`${window.location.origin} /?share=${i.id}`),te(!0),setTimeout(()=>te(!1),2e3)},className:"p-2 rounded-lg bg-white border text-sm font-bold",children:pe?"Copiado":"Copiar"})]})]})}),de&&!J&&e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in-up",children:e.jsxs("div",{className:`w-full max-w-lg rounded-2xl shadow-2xl p-8 border ${j?"bg-slate-900 border-slate-700":"bg-white border-slate-200"}`,children:[e.jsx("button",{onClick:()=>_(!1),className:"absolute top-4 right-4 p-2 text-slate-400",title:"Fechar",children:e.jsx(oe,{size:20})}),me==="OPTIONS"?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>{x(E,k),_(!1),S==null||S("Projeto salvo com sucesso!","success")},className:"flex flex-col items-center p-4 rounded-xl border-2 hover:border-indigo-500 transition-all",children:[e.jsx(He,{size:28,className:"mb-2 text-indigo-600"})," ",e.jsx("span",{className:"font-bold text-sm",children:"Projeto"})]}),e.jsxs("button",{onClick:()=>{u==="FREE"?(Q({reason:"FEATURE_LOCKED",featureName:"Modelos Personalizados"}),I(!0)):(ee(""),q("TEMPLATE_NAME"))},className:"flex flex-col items-center p-4 rounded-xl border-2 hover:border-purple-500 transition-all",children:[e.jsx(Pe,{size:28,className:"mb-2 text-purple-600"})," ",e.jsx("span",{className:"font-bold text-sm",children:"Modelo"})]})]}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Salvar como Modelo"}),e.jsx("input",{type:"text",value:U,onChange:s=>ee(s.target.value),placeholder:"Nome do modelo",className:"p-3 rounded-xl border-2 outline-none"}),e.jsx("button",{onClick:()=>{N==null||N(E,k,U),_(!1)},className:"py-3 bg-purple-600 text-white rounded-xl font-bold",children:"Salvar Modelo"}),e.jsx("button",{onClick:()=>q("OPTIONS"),className:"text-sm text-slate-500 hover:underline",children:"Voltar"})]})]})}),e.jsx("div",{className:"flex-1 h-full relative transition-colors duration-300",ref:ne,onMouseMove:ye,children:e.jsxs(We,{nodes:E,edges:ge,onNodesChange:fe,onEdgesChange:be,onConnect:Se,onInit:ie,onDrop:je,onDragOver:s=>s.preventDefault(),onNodeDrag:Ae,onNodeDragStop:Ce,nodeTypes:Ee,edgeTypes:he,defaultEdgeOptions:Ne,connectionMode:Ve.Loose,nodesDraggable:!c,fitView:!0,snapToGrid:!0,children:[se&&e.jsx(at,{snapLines:se,reactFlowInstance:K}),e.jsx(Ye,{color:j?"#334155":"#cbd5e1",gap:24,variant:Xe.Dots}),e.jsx(Ze,{}),e.jsx(Je,{}),e.jsxs(Qe,{position:"top-right",className:"flex gap-2",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border font-bold text-sm ${E.length>=R?"bg-red-100 text-red-600 border-red-200":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 dark:text-slate-300"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${E.length>=R?"bg-red-500 animate-pulse":"bg-green-500"}`}),E.length," / ",R>=9999?"∞":R]}),e.jsx("button",{onClick:L,className:"p-2 rounded-lg bg-white dark:bg-slate-800 border",children:j?e.jsx(qe,{size:20}):e.jsx(Ue,{size:20})})]})]})})]})},ft=i=>e.jsx(_e,{children:e.jsx(lt,{...i})});export{ft as default};
